# Схема базы данных проекта QuickFlow
## Краткое описание сущностей
### User
Хранит данные пользователей.
- `id` (PK) --- Уникальный идентификатор пользователя.
- `username` --- Уникальный логин пользователя.
- `psw_hash` --- Хеш пароля.
- `salt` --- Соль для хеширования.

### Profile
Дополнительные данные профиля пользователя.
- `id` (PK, FK → User.id) --- ID владельца профиля.
- `bio` --- Описание.
- `profile_avatar` --- Ссылка на аватар.
- `firstname`, `lastname`, `sex`, `birth_date` --- Персональные данные.

### Post
Хранит опубликованные посты.
- `id` (PK) --- Уникальный идентификатор поста.
- `creator_id` (FK → User.id) --- Автор поста.
- `text` --- Текстовое содержимое поста.
- `created_at` --- Дата создания.
- `like_count`, `repost_count`, `comment_count` --- Счётчики активности.
- `is_repost` --- Флаг репоста.

### PostFile
Связывает фотографии поста с post_id.
- `id` (PK)
- `post_id` (FK → Post.id) -- ID поста.
- `file_url` -- URL файла.

### Repost
Связывает оригинальные посты и репосты.
- `repost_id` (PK, FK → Post.id) --- ID репоста.
- `original_id` (FK → Post.id) --- ID оригинального поста.

### Comment
Хранит комментарии к постам.
- `id` (PK) --- Уникальный ID комментария.
- `post_id` (FK → Post.id) --- К какому посту относится.
- `user_id` (FK → User.id) --- Кто написал.
- `created_at` --- Дата.
- `like_count` --- Количество лайков.

### LikePost
Связь между пользователем и лайкнутым постом.
- `id` (PK) --- Уникальный ID лайка.
- `user_id` (FK → User.id) --- Кто лайкнул.
- `post_id` (FK → Post.id) --- Какой пост лайкнут.
- `created_at` --- Дата.

### LikeComment
Связь между пользователем и лайкнутым комментарием.
- `id` (PK) --- Уникальный ID лайка.
- `user_id` (FK → User.id) --- Кто лайкнул.
- `comment_id` (FK → Comment.id) --- Какой комментарий лайкнут.
- `created_at` --- Дата.

### Message
Содержит сообщения в чатах.
- `id` (PK) --- Уникальный идентификатор.
- `sender_id` (FK → User.id) --- Отправитель.
- `chat_id` (FK → Chat.id) --- Чат.
- `text` --- Содержание.
- `created_at` --- Дата.
- `is_read` --- Прочитано или нет.

### Chat
Содержит информацию о чатах.
- `id` (PK) --- Уникальный ID чата.
- `type` --- Тип (личный или групповой).
- `created_at` --- Дата создания.

### ChatUser
Связь пользователей с чатами.
- `id` (PK)
- `chat_id` (FK → Chat.id) --- ID чата.
- `user_id` (FK → User.id) --- ID пользователя.

### Community
Хранит данные сообществ.
- `id` (PK) --- Уникальный ID сообщества.
- `owner_id` (FK → User.id) --- Владелец.
- `name` -- Название сообщества.
- `description` --- Описание.
- `created_at` --- Дата создания.

### CommunityUser
Связывает пользователей с сообществами.
- `id` (PK) --- Уникальный ID связи.
- `community_id` (FK → Community.id) --- В каком сообществе.
- `user_id` (FK → User.id) --- Кто состоит.
- `role` --- Роль (участник, админ).
- `joined_at` --- Дата вступления.

### CommunityFollow
Кто на какие сообщества подписан.
- `id` (PK) --- Уникальный ID подписки.
- `community_id` (FK → Community.id) --- Сообщество.
- `user_id` (FK → User.id) --- Кто подписан.

### UserFollow
Связывает подписчиков и подписки.
- `id` (PK) --- Уникальный ID подписки.
- `following_id` (FK → User.id) --- Кто подписался.
- `followed_id` (FK → User.id) --- На кого подписан.

### Friendship
Связь между пользователями (друзья).
- `id` (PK) --- Уникальный ID дружбы.
- `user_id` (FK → User.id) --- Кто отправил запрос в друзья.
- `friend_id` (FK → Post.id) --- Кому пришел запрос в друзья.
- `status` --- Статус отправленного запроса.

---

## Нормализация
### Описание нормальных форм
Переменная отношения находится в **первой нормальной форме (1НФ)** тогда и только тогда, когда в любом допустимом значении отношения каждый его кортеж содержит только одно значение для каждого из атрибутов.

Переменная отношения находится во **второй нормальной форме (2НФ)** тогда и только тогда, когда она находится в первой нормальной форме, и каждый неключевой атрибут неприводимо (функционально полно) зависит от ее потенциального ключа.

Переменная отношения находится в **третьей нормальной форме (3НФ)**, когда она находится во второй нормальной форме, и отсутствуют транзитивные функциональные зависимости неключевых атрибутов от ключевых.

Переменная отношения находится в **нормальной форме Бойса --- Кодда (НФБК)** тогда и только тогда, когда каждая её нетривиальная и неприводимая слева функциональная зависимость имеет в качестве своего детерминанта некоторый потенциальный ключ.


### Функциональные зависимости
Тривиальные зависимости `{x} → {x}` не указываются.

### **User**: `id`, `username`, `psw_hash`, `salt`
- `{id} → {id, username, psw_hash, salt}` --  первичный ключ в качестве детерминанта. Все множества атрибутов типа {Пот.К./Перв.К. + атрибут} -- это суперключ, из которого также выводятся все атрибуты отношения. Покажем это ниже.
- `{id, username} → {id, username, psw_hash, salt}`
- `{id, psw_hash} → {id, username, psw_hash, salt}`
- `{id, salt} → {id, username, psw_hash, salt}`
- `{id, username, psw_hash} → {id, username, psw_hash, salt}`
- `{id, username, salt} → {id, username, psw_hash, salt}`
- `{id, salt, psw_hash} → {id, username, psw_hash, salt}`
- `{id, username, psw_hash, salt} → {id, username, psw_hash, salt}`
- `{username} → {id, username, psw_hash, salt}` -- потенциальный ключ в качестве детерминанта (username уникален). К описанным выше ФЗ добавятся следующие:
- `{username, psw_hash} → {id, username, psw_hash, salt}`
- `{username, salt} → {id, username, psw_hash, salt}`
- `{username, psw_hash, salt} → {id, username, psw_hash, salt}`

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (psw_hash, salt) неприводимо зависит от потенциального ключа (id/username).  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (таких две -- с id и с username в левой части) имеет в качестве детерминанта потенциальный ключ.

Поскольку ФЗ с суперключами в левой части не играют роли в принадлежности отношения к НФ с 1 по НФБК, далее будем приводить ФЗ с левыми частями, не являющимися суперключами.

### **Profile**: `id`, `bio`, `profile_avatar`, `firstname`, `lastname`, `sex`, `birth_date`
- `{id} → {id, bio, profile_avatar, firstname, lastname, sex, birth_date}`
- ФЗ с суперключами от id в левой части: `{id, <атрибуты>} → {все атрибуты отношения}`.

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (все, кроме id) неприводимо зависит от потенциального ключа (id).  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (такая лишь одна, записанная первой) имеет в качестве детерминанта потенциальный ключ.

### **Post**: `id`, `creator_id`, `text`, `created_at`, `like_count`, `repost_count`, `comment_count`, `is_repost`
- `{id} → {id, creator_id, text, created_at, like_count, repost_count, comment_count, is_repost}`
- ФЗ с суперключами от id в левой части: `{id, <атрибуты>} → {все атрибуты отношения}`.

Примечание: здесь не был рассмотрен потенциальный ключ `{creator_id, created_at}`, поскольку формат временной метки подразумевает секундную точность, однако вполне можно себе представить ситуацию, при которой происходит добавление двух комментариев или постов с разницей не более, чем в 1 секунду (с двух устройств под одним аккаунтом).

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (все, кроме id) неприводимо зависит от потенциального ключа (id).  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (такая лишь одна, записанная первой) имеет в качестве детерминанта потенциальный ключ.

### **PostFile**: `id`, `post_id`, `file_url`
- `{id} → {id, post_id, file_url}`
- ФЗ с суперключами от id в левой части: `{id, <атрибуты>} → {все атрибуты отношения}`.

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (все, кроме id) неприводимо зависит от потенциального ключа (id).  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (такая лишь одна, записанная первой) имеет в качестве детерминанта потенциальный ключ.

### **Repost**: `repost_id`, `original_id`
- `{repost_id} → {repost_id, original_id}`
- `{repost_id, original_id} → {repost_id, original_id}`.

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (original_id) неприводимо зависит от потенциального ключа (repost_id).  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (такая лишь одна, записанная первой) имеет в качестве детерминанта потенциальный ключ.

### **Comment**: `id`, `post_id`, `user_id`, `created_at`, `like_count`
- `{id} → {id, post_id, user_id, created_at, like_count}`
- ФЗ с суперключами от `{id}` в левой части: `{пот.ключ, <атрибуты>} → {все атрибуты отношения}`.

Примечание: здесь не был рассмотрен потенциальный ключ `{user_id, post_id, created_at}`, поскольку формат временной метки подразумевает секундную точность, однако вполне можно себе представить ситуацию, при которой происходит добавление двух комментариев или постов с разницей не более, чем в 1 секунду (с двух устройств под одним аккаунтом).

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (likecount) неприводимо зависит от потенциального ключа (например, id).  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (две, записанные первыми) имеет в качестве детерминанта потенциальный ключ (во втором случае --- составной).

### **LikePost**: `id`, `user_id`, `post_id`, `created_at`
- `{id} → {id, user_id, post_id, created_at}`
- `{user_id, post_id} → {id, user_id, post_id, created_at}`
- ФЗ с суперключами от `{id}` или `{user_id, post_id}` в левой части: `{пот.ключ, <атрибуты>} → {все атрибуты отношения}`.

Примечание: здесь не был рассмотрен потенциальный ключ `{user_id, created_at}` или `{post_id, created_at}`, поскольку формат временной метки подразумевает секундную точность, однако вполне можно себе представить ситуацию, при которой происходит добавление двух комментариев или постов с разницей не более, чем в 1 секунду (с двух устройств под одним аккаунтом).

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (created_at) неприводимо зависит от потенциального ключа (например, id).  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (две, записанные первыми) имеет в качестве детерминанта потенциальный ключ (во втором случае --- составной).

### **LikeComment**: `id`, `user_id`, `comment_id`, `created_at`
- `{id} → {id, user_id, comment_id, created_at}`
- `{user_id, comment_id} → {id, user_id, comment_id, created_at}`
- ФЗ с суперключами от `{id}` или `{user_id, comment_id}` в левой части: `{пот.ключ, <атрибуты>} → {все атрибуты отношения}`.

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (created_at) неприводимо зависит от потенциального ключа (например, id).  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (две, записанные первыми) имеет в качестве детерминанта потенциальный ключ (во втором случае --- составной).

### **Message**: `id`, `sender_id`, `chat_id`, `text`, `created_at`, `is_read`
- `{id} → {id, sender_id, chat_id, text, created_at, is_read}`
- ФЗ с суперключами от `{id}` в левой части: `{пот.ключ, <атрибуты>} → {все атрибуты отношения}`.

Примечание: множество атрибутов `{sender_id, chat_id, created_at}` не рассматривается как потенциальный ключ по причинам, описанным в примечаниях выше.

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (sender_id, chat_id, text, created_at, is_read) неприводимо зависит от потенциального ключа (id).  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (одна, выписанная первой) имеет в качестве детерминанта потенциальный ключ.

### **Chat**: `id`, `type`, `created_at`
- `{id} → {id, type, created_at}`
- ФЗ с суперключами от `{id}` в левой части: `{пот.ключ, <атрибуты>} → {все атрибуты отношения}`.

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (type, created_at) неприводимо зависит от потенциального ключа (id).  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (одна, выписанная первой) имеет в качестве детерминанта потенциальный ключ.

### **ChatUser**: `id`, `chat_id`, `user_id`
- `{id} → {id, chat_id, user_id}`
- `{chat_id, user_id} → {id, chat_id, user_id}`.

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (таких нет) неприводимо зависит от потенциального ключа.  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (обе выписанные) имеет в качестве детерминанта потенциальный ключ.

### **Community**: `id`, `owner_id`, `name`, `description`, `created_at`
- `{id} → {id, owner_id, name, description, created_at}`
- `{name} → {id, name, owner_id, description, created_at}`
- ФЗ с суперключами от `{id}`, `{name}` в левой части: `{пот.ключ, <атрибуты>} → {все атрибуты отношения}`.

Примечание: множество `{owner_id, created_at}` не рассматривается как потенциальный ключ по причинам, описанным в предыдущих замечаниях.

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (owner_id, description, created_at) неприводимо зависит от потенциального ключа (например, id).  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (обе выписанные) имеет в качестве детерминанта потенциальный ключ.

### **CommunityUser**: `id`, `community_id`, `user_id`, `role`, `joined_at`
- `{id} → {id, community_id, user_id, role, joined_at}`
- `{community_id, user_id} → {id, community_id, user_id, role, joined_at}`
- ФЗ с суперключами от `{id}`, `{community_id, user_id}` в левой части: `{пот.ключ, <атрибуты>} → {все атрибуты отношения}`.

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (role, joined_at) неприводимо зависит от потенциального ключа (например, id).  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (обе выписанные) имеет в качестве детерминанта потенциальный ключ.

### **CommunityFollow**: `id`, `community_id`, `user_id`
- `{id} → {id, community_id, user_id}`
- `{community_id, user_id} → {id, community_id, user_id}`.

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (таких нет) неприводимо зависит от потенциального ключа.  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (обе выписанные) имеет в качестве детерминанта потенциальный ключ.

### **UserFollow**: `id`, `following_id`, `followed_id`
- `{id} → {following_id, followed_id}`
- `{following_id, followed_id} → {id}`.

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (таких нет) неприводимо зависит от потенциального ключа.  
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ (обе выписанные) имеет в качестве детерминанта потенциальный ключ.

### **Friendship**: `id`, `user_id`, `friend_id`, `status`
- `{id} → {id, user_id, friend_id, status}`
- `{user_id, friend_id} → {id, user_id, friend_id, status}`

Отношение находится в 1НФ, поскольку все поля простые.  
Отношение находится в 2НФ, поскольку каждый неключевой атрибут (status) неприводимо зависит от потенциального ключа (например, id).
Отношение находится в 3НФ, поскольку отсутствуют транзитивные ФЗ неключевых атрибутов от ключевых.  
Отношение находится в НФБК, поскольку каждая нетривиальная и неприводимая слева ФЗ имеет в качестве детерминанта потенциальный ключ.